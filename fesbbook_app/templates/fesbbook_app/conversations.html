{% extends "fesbbook_app/base.html"%}

{% block additional_styles %}
<style>
#display_profile_image {
    float: left;
    width: 100px;
    height: 100px;
    background-size: cover;
    border-radius: 50%;
    border: 5px solid #007bff;
    object-fit: cover;
  }
  .card:hover {
    transition: 0.5s ease;
    background-color: #6c757d!important;
    cursor: pointer;
  }
  .card {
    transition: 0.5s ease;
  }
  .number_of_unread {
      font-size: 16px;
      height: 25px;
      width: 25px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: auto;
      margin-bottom: 12px;
  }
  #unread_message_display {
      text-decoration: underline;
      font-weight: bold;
  }
  .isActive {
    position: absolute;
    left: 110px;
    top: 0;
    height: 25px;
    width: 25px;
    border-radius: 50%;
  }
</style>
{% endblock additional_styles %}

{% block title %}Razgovori{% endblock title %}
{% block content %}
{% if lastMessages|length == 0 %}
<br>
Trenutno nemate razgovora u kojim sudjelujete. Povratak na <a href="studentList">listu svih studenata</a>.
{% endif %}
    {% for conversation in lastMessages %}
    {% if conversation.receiver.username == request.session.loggedInUser %}
    <div class="card flex-row flex-wrap bg-dark" onclick="window.location='conversation/{{conversation.sender.username}}';">
        <div class="card-header border-0">
            <img src="{{conversation.sender.profile_image}}" alt="Profile image" id="display_profile_image">
            {% if conversation.sender.isActive %}
            <div class="isActive bg-success"></div>
            {% endif %}
        </div>
        
        {% if conversation.is_read %}
        <div class="card-block px-2">
            <h4 class="card-title">{{conversation.sender.username}}</h4>
            <p class="card-text"><b>{{conversation.sender.username}}</b>: {{conversation.message}}</p>
        </div>
        {% else %}
        <div class="card-block px-2">
            <div class="d-flex flex-row">
                <h4 class="card-title flex-row flex-wrap mr-2">{{conversation.sender.username}}</h4>
                <div class="number_of_unread bg-danger align-self-center">{{conversation.unreadMessages}}</div>
            </div>
            <p class="card-text" id="unread_message_display">{{conversation.message}}</p>
        </div>
        {% endif %}
        
        <div class="card-footer w-100">
            {{conversation.date_sent|date:"j. n. Y. G:i"}}<br/>
            {% if conversation.is_read %}
            <div class="text-muted">Pro훾itano</div>
            {% else %}
            <div class="text-primary">Nepro훾itano</div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="card flex-row flex-wrap bg-dark" onclick="window.location='conversation/{{conversation.receiver.username}}';">
        <div class="card-header border-0">
            <img src="{{conversation.receiver.profile_image}}" alt="Profile image">
            {% if conversation.receiver.isActive %}
            <div class="isActive bg-success"></div>
            {% endif %}
        </div>
        <div class="card-block px-2">
            <h4 class="card-title">{{conversation.receiver.username}}</h4>
            <p class="card-text">{{conversation.message}}</p>
        </div>
        <div class="card-footer w-100">
            {{conversation.date_sent|date:"j. n. Y. G:i"}}<br/>
            {% if conversation.is_read %}
            <div class="text-muted">Pro훾itano</div>
            {% else %}
            <div class="text-primary">Nepro훾itano</div>
            {% endif %}
        </div>
        
    </div><br>
    {% endif %}
    
    {% endfor %}
{% endblock content %}

{% block script %}
<script>
//     var loc = window.location

//   var wsStart = ""

//   loc.protocol == "https:" ? wsStart = "wss://" : wsStart = "ws://"

//   var endpoint = wsStart + loc.host + loc.pathname

//   var socket = new WebSocket(endpoint)

//   socket.onmessage = function(e) {
//       console.log("message", e)
//   }
//   socket.onopen = function(e) {
//       console.log("open", e)
//   }
//   socket.onerror = function(e) {
//       console.log("error", e)
//   }
//   socket.onclose = function(e) {
//       console.log("close", e)
//   }

</script>
{% endblock script %}
